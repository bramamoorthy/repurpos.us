<div class="container-fluid" *ngIf="displayResults">
  <h3>Search results</h3>

  <ng-container [ngSwitch]="responseCode">
    <ng-container *ngSwitchCase="200">

      <div class="search-result-container mat-elevation-z0" *ngIf="dataSource.data.length > 0; else no_data">
        <mat-table #table matSort (matSortChange)="onSortChange($event)" [dataSource]="dataSource">

          <!-- Drug name -->
          <ng-container matColumnDef="main_label">
            <mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header">
              <span class="mat-header">Name</span>
              <mat-icon class='sort-icon' matTooltip="sort by name">sort</mat-icon>
            </mat-header-cell>
            <mat-cell *matCellDef="let element; let row=index" class="main-label">
              <a [routerLink]="['/compound_data', element.id.split('/').pop(), {qid: element.qid.split('/').pop()}]">
                <h5>{{element['main_label']}}</h5>
              </a>
              <mat-icon *ngIf="!notMobile" class="more-info" (click)="expandCell($event)">expand_more</mat-icon>



              <table class="table cmpd-info">
                <tbody>

                  <!-- Aliases -->
                  <tr *ngIf="element.aliases.length > 0">
                    <th class="label" scope="row">Aliases:</th>
                    <td class="aliases">
                      <ul class="alias-list">
                        <li *ngFor="let alias of element.aliases | slice:0:element.alias_ct; let i=index" class="alias">
                          <!-- <ng-container *ngIf="i < num_aliases"> -->
                          {{alias}}
                          <span *ngIf="i + 1 < element.alias_ct && i + 1 < element.aliases.length" class='data-separator'></span>
                        </li>
                        <li>
                          <a *ngIf="element.alias_ct < element.aliases.length || element.max_aliases" id="more" (click)="showMore(row)" class="center-block">
                          {{ element.max_aliases ? 'show less' : 'show more' }}
                        </a>
                        </li>
                      </ul>
                    </td>
                  </tr>

                  <!-- Inchi key / ID -->
                  <tr>
                    <th class="label" scope="row">ID:</th>
                    <td class="inchi-id">
                      {{element['id']}}
                    </td>
                  </tr>


                </tbody>
              </table>


            </mat-cell>
          </ng-container>






          <!-- In physical library -->
          <ng-container matColumnDef="reframeid">
            <mat-header-cell *matHeaderCellDef mat-sort-header start="desc" class="mat-header">
              <span class="mat-header">
              Sample in Screening Library </span>
              <mat-icon class='sort-icon' matTooltip="sort by library compound">sort</mat-icon>
            </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <!-- binary circle if compound in reframe library -->
              <div id="reframe_cmpd" [ngClass]="element['reframeid'] === true ? 'cmpd-avail' : 'no-cmpd'">
                <div>
                  <span class="circle"></span>
                </div>

                <app-search-result-similar [compound_result]="element"></app-search-result-similar>

              </div>



            </mat-cell>
          </ng-container>

          <!-- Tanimoto score -->
          <ng-container matColumnDef="tanimoto">
            <mat-header-cell *matHeaderCellDef mat-sort-header class="mat-header">
              <span class="mat-header">Tanimoto Similarity Score</span>
              <mat-icon class='sort-icon' matTooltip="sort by Tanimoto score">sort</mat-icon>
            </mat-header-cell>
            <mat-cell *matCellDef="let element" [ngStyle]="{'background-color': tanimotoScale(element['tanimoto']), 'color': getFontColor(element['tanimoto'])}">
              {{element['tanimoto'] | number: '1.2-2'}}
              <!-- </div> -->

              <!-- <div class="exact-match">exact match</div> -->

            </mat-cell>
          </ng-container>

          <!-- Structure -->
          <ng-container matColumnDef="struct">
            <mat-header-cell *matHeaderCellDef>
              <span class="mat-header">Structure</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <a [routerLink]="['/compound_data', element.id.split('/').pop(), {qid: element.qid.split('/').pop()}]">
                <app-struct2d [structure]="element['id']" struct_type="inchikey" *ngIf="element['id'].length === 27"></app-struct2d>
              </a>
            </mat-cell>
          </ng-container>

          <!-- Assay titles -->
          <ng-container matColumnDef="assays">
            <mat-header-cell *matHeaderCellDef class="assay-label" mat-sort-header start="desc" class="mat-header">
              <span class="mat-header">Assay Hits</span>
              <mat-icon class='sort-icon' matTooltip="sort by number of assay hits">sort</mat-icon>
            </mat-header-cell>
            <mat-cell *matCellDef="let element" class="flex-column">
              <span class="circle" [ngStyle]="{'background-color': 'rgba(65, 74, 81,' + getColor(element.assay_types) + ')'}"></span>

              <ul class="assay-list">
                <li class="assay-title" *ngFor="let assay of element.assay_types; let i=index">
                  <a [routerLink]="['/assays', assay[1]]" target="_blank">{{assay[0]}}</a>
                  <!-- <span *ngIf="i + 1 < element.assay_types.length" class='data-separator'></span> -->
                </li>
              </ul>
              <!-- <span class="circle" [ngStyle]="{'background-color': 'rgba(85, 98, 109,' + getColor(element.assay_types) + ')'}"></span> -->
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="assay_titles">
            <mat-header-cell *matHeaderCellDef class="assay-label"></mat-header-cell>
            <mat-cell *matCellDef="let element">
              <ul class="assay-list">
                <li class="assay-title" *ngFor="let assay of element.assay_types; let i=index">
                  <a [routerLink]="['/assays', assay[1]]" target="_blank">{{assay[0]}}</a>
                  <!-- <span *ngIf="i + 1 < element.assay_types.length" class='data-separator'></span> -->
                </li>
              </ul>
              <!-- <span [ngClass]="element['assay_types'].indexOf(assay) > -1 ? 'circle assay-avail' : 'circle no-assay'"></span> -->
            </mat-cell>
          </ng-container>


          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns; let element; let i = index" id="{{i}}"></mat-row>
          <!-- Original routing, where row click directs to compound page -->
          <!-- <mat-row *matRowDef="let row; columns: displayedColumns; let element;" (click)="rowClicked($event, element['qid'], element['id'])"></mat-row> -->
        </mat-table>

        <mat-paginator #paginator [pageSize]="pageSize" [pageSizeOptions]="[10, 25, 50, 100]" (page)="onPageChange($event)">
        </mat-paginator>

      </div>
    </ng-container>

    <!-- Display "nothing found" if no data -->
    <ng-template #no_data>
      <div class="no-results">
        No results found
      </div>
    </ng-template>

    <ng-container *ngSwitchCase="500">
      <p>
        ReframeDB is currently down. Please email <a href="mailto:help@reframedb.org?subject=ReFrameDB 500 status: {{ APIquery }}">help@reframedb.org</a> to let us know.
        <p>

    </ng-container>

    <ng-container *ngSwitchDefault>
      <p>
        Your query resulted in an error. Often, this happens if the inputted structure is an invalid SMILES string or InChI key. </p>
      <p>
        Check the SMILES structure for improper aromatization, use keuklized SMILES strings, and/or remove generic atoms.</p>
      <p>

        Please try again and if it persists, email <a href="mailto:help@reframedb.org?subject=ReFrameDB bad query: {{ APIquery }}">help@reframedb.org</a>
      </p>
    </ng-container>
  </ng-container>

</div>
