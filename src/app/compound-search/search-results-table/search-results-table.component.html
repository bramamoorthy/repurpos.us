<div class="container" *ngIf="displayResults">
  <h3>Search results</h3>

  <ng-container [ngSwitch]="responseCode">
    <ng-container *ngSwitchCase="200">

      <div class="search-result-container mat-elevation-z0" *ngIf="dataSource.data.length > 0; else no_data">
        <mat-table #table matSort (matSortChange)="onSortChange($event)" [dataSource]="dataSource">

          <!-- Drug name -->
          <ng-container matColumnDef="main_label">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Name
              <mat-icon class='sort-icon'>sort</mat-icon>
            </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <a [routerLink]="['/compound_data', element.id.split('/').pop(), {qid: element.qid.split('/').pop()}]">
                {{element['main_label']}}
              </a>
              <mat-icon *ngIf="!notMobile" class="more-info" (click)="expandCell($event)">expand_more</mat-icon>
            </mat-cell>
          </ng-container>



          <!-- Aliases -->
          <ng-container matColumnDef="alias">
            <mat-header-cell *matHeaderCellDef>Aliases
            </mat-header-cell>
            <mat-cell *matCellDef="let element; let row=index">
              <div>
                <ul class="alias-list">
                  <li *ngFor="let alias of element.aliases | slice:0:element.alias_ct; let i=index" class="alias">
                    <!-- <ng-container *ngIf="i < num_aliases"> -->
                    {{alias}}
                    <span *ngIf="i + 1 < element.alias_ct && i + 1 < element.aliases.length" class='data-separator'></span>
                  </li>
                  <li>
                    <a *ngIf="element.alias_ct < element.aliases.length" id="more" (click)="showMore(row)" class="center-block">
                  show more
                </a>
                  </li>
                </ul>
              </div>
              <!-- Button to load more results -->

            </mat-cell>
          </ng-container>

          <!-- Main ID -->
          <ng-container matColumnDef="id">
            <mat-header-cell *matHeaderCellDef>ID</mat-header-cell>
            <mat-cell *matCellDef="let element">{{element['id']}}</mat-cell>
          </ng-container>



          <!-- In physical library -->
          <ng-container matColumnDef="reframeid">
            <mat-header-cell *matHeaderCellDef mat-sort-header start="desc">Sample in Screening Library
              <mat-icon class='sort-icon'>sort</mat-icon>
            </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <!-- binary circle if compound in reframe library -->
              <div id="reframe_cmpd" [ngClass]="element['reframeid'] === true ? 'cmpd-avail' : 'no-cmpd'">
                <div>
                  <span class="circle"></span>
                </div>



                <div>
                  <!-- Check if there are similar compounds, if not a Reframe compound -->
                  <div class="similar" *ngIf="element['reframeid'] === false && element['similar_compounds'].length > 0" matTooltip="Tanimoto score > 0.85">
                    <div>
                      {{element['similar_compounds'].length === 1 ? "similar library compound:" : "similar library compounds:"}}
                    </div>


                    <ng-container *ngIf="element['similar_compounds'].length <= num_similar; else lotsa_similar">
                      <ng-container *ngFor="let related of element['similar_compounds'] | slice:0:num_similar; let i=index">
                        <a [routerLink]="['/compound_data', related.compound_id.split('/').pop(), {qid: related.qid.split('/').pop()}]">
                        {{related['main_label']}}
                      </a>
                        <span *ngIf="i + 1 < element['similar_compounds'].length" class='data-separator'></span>
                      </ng-container>
                    </ng-container>

                    <!-- If there are > 2 similar compounds -->
                    <ng-template #lotsa_similar>
                      <mat-expansion-panel (opened)="element.similar_showall = true" (closed)="element.similar_showall = false">
                        <mat-expansion-panel-header collapsedHeight="auto">
                          <mat-panel-title>
                            <ng-container *ngFor="let related of element['similar_compounds'] | slice:0:num_similar; let i=index">
                              <a [routerLink]="['/compound_data', related.compound_id.split('/').pop(), {qid: related.qid.split('/').pop()}]">
            {{related['main_label']}}
          </a>
                              <span *ngIf="i + 1 < num_similar" class='data-separator'></span>

                            </ng-container>
                            <a>show {{element['similar_showall'] ? "less" : "more"}}</a>
                          </mat-panel-title>
                        </mat-expansion-panel-header>

                        <ng-container *ngFor="let related of element['similar_compounds'] | slice:num_similar:element['similar_compounds'].length; let i=index">
                          <a [routerLink]="['/compound_data', related.compound_id.split('/').pop(), {qid: related.qid.split('/').pop()}]">
        {{related['main_label']}}
      </a>
                          <span *ngIf="i + 1 < element['similar_compounds'].length - num_similar" class='data-separator'></span>

                        </ng-container>

                      </mat-expansion-panel>
                    </ng-template>
                  </div>

                </div>
              </div>

              <!-- <div class="parent">
   <div class="child">***</div>
</div> -->



            </mat-cell>
          </ng-container>

          <!-- Tanimoto score -->
          <ng-container matColumnDef="tanimoto">
            <mat-header-cell *matHeaderCellDef mat-sort-header>
              Tanimoto Similarity Score
              <mat-icon class='sort-icon'>sort</mat-icon>
            </mat-header-cell>
            <mat-cell *matCellDef="let element" [ngStyle]="{'background-color': tanimotoScale(element['tanimoto']),
    'color': getFontColor(element['tanimoto'])}">
              {{element['tanimoto'] | number: '1.2-2'}}</mat-cell>
          </ng-container>

          <!-- Structure -->
          <ng-container matColumnDef="struct">
            <mat-header-cell *matHeaderCellDef>
              Structure
            </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <a [routerLink]="['/compound_data', element.id.split('/').pop(), {qid: element.qid.split('/').pop()}]">
                <app-struct2d [structure]="element['id']" struct_type="inchikey" *ngIf="element['id'].length === 27"></app-struct2d>
              </a>
            </mat-cell>
          </ng-container>

          <!-- Assay titles -->
          <ng-container matColumnDef="assays">
            <mat-header-cell *matHeaderCellDef class="assay-label" mat-sort-header start="desc">
              assay hits
              <mat-icon class='sort-icon'>sort</mat-icon>
            </mat-header-cell>
            <mat-cell *matCellDef="let element">
              <span class="circle" [ngStyle]="{'background-color': 'rgba(65, 74, 81,' + getColor(element.assay_types) + ')'}"></span>
              <!-- <span class="circle" [ngStyle]="{'background-color': 'rgba(85, 98, 109,' + getColor(element.assay_types) + ')'}"></span> -->
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="assay_titles">
            <mat-header-cell *matHeaderCellDef class="assay-label"></mat-header-cell>
            <mat-cell *matCellDef="let element">
              <ul class="assay-list">
                <li class="assay-title" *ngFor="let assay of element.assay_types; let i=index">
                  <a [routerLink]="['/assays', assay[1]]" target="_blank">{{assay[0]}}</a>
                  <span *ngIf="i + 1 < element.assay_types.length" class='data-separator'></span>
                </li>
              </ul>
              <!-- <span [ngClass]="element['assay_types'].indexOf(assay) > -1 ? 'circle assay-avail' : 'circle no-assay'"></span> -->
            </mat-cell>
          </ng-container>

          <!-- File Statuses Column: splayed out-->
          <!-- <span *ngFor="let assay of assays; let i=index">
<ng-container matColumnDef="{{ assay }}">
  <mat-header-cell *matHeaderCellDef class="assay-label"> {{ assay }} </mat-header-cell>
  <mat-cell *matCellDef="let element">
    <span [ngClass]="element['assay_types'].indexOf(assay) > -1 ? 'circle assay-avail' : 'circle no-assay'"></span>
      </mat-cell>
      </ng-container>
      </span> -->

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns; let element; let i = index" id="{{i}}"></mat-row>
          <!-- Original routing, where row click directs to compound page -->
          <!-- <mat-row *matRowDef="let row; columns: displayedColumns; let element;" (click)="rowClicked($event, element['qid'], element['id'])"></mat-row> -->
        </mat-table>

        <mat-paginator #paginator [pageSize]="pageSize" [pageSizeOptions]="[10, 25, 50, 100]" (page)="onPageChange($event)">
        </mat-paginator>

      </div>
    </ng-container>

    <!-- Display "nothing found" if no data -->
    <ng-template #no_data>
      <div class="no-results">
        No results found
      </div>
    </ng-template>

    <ng-container *ngSwitchCase="500">
      <p>
        ReframeDB is currently down. Please email <a href="mailto:help@reframedb.org?subject=ReFrameDB 500 status: {{ APIquery }}">help@reframedb.org</a> to let us know.
        <p>

    </ng-container>

    <ng-container *ngSwitchDefault>
      <p>
        Your query resulted in an error. Often, this happens if the inputted structure is an invalid SMILES string or InChI key. </p>
      <p>
        Check the SMILES structure for improper aromatization, use keuklized SMILES strings, and/or remove generic atoms.</p>
      <p>

        Please try again and if it persists, email <a href="mailto:help@reframedb.org?subject=ReFrameDB bad query: {{ APIquery }}">help@reframedb.org</a>
      </p>
    </ng-container>
  </ng-container>

</div>
